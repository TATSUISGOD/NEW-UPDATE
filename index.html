<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button,input{font-size:15px;padding:8px 14px;margin:4px}
#tapBtn{font-size:26px;padding:28px 56px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:72px}
.player{font-size:60px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:999;font-size:20px;text-align:center;padding:20px}
#timer{font-size:18px;margin-top:6px;color:#ffcc00}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>ğŸ’° <span id="coin">0</span>ã€€ğŸ’ <span id="dia">0</span>ã€€âš” +<span id="atk">0</span></p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
<button onclick="draw10()">ğŸ° 10é€£</button>
<button onclick="draw100()">ğŸ° 100é€£</button>

<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½</button>
<button onclick="drawDia10()">ğŸ’ ä¸Šä½10é€£</button>
<button onclick="drawDia100()">ğŸ’ ä¸Šä½100é€£</button>

<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<input id="diaNum" type="number" min="1" placeholder="å¤‰æ›æ•°">
<button onclick="exchangeDia()">ğŸ’°â†’ğŸ’å¤‰æ›</button>

<hr>

<button id="autoBtn" onclick="toggleAuto()">ğŸ¤– ã‚ªãƒ¼ãƒˆã‚¿ãƒƒãƒ—: OFF</button>

<hr>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³',180,'ğŸ‘º',18)">ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',400,'ğŸ‘¹',40)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',2000,'ğŸ‰',200)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥ç«œ',8000,'ğŸ²âœ¨',800)">ç¥ç«œ</button>
<br><br>
<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div id="timer" class="hidden"></div>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atkBonus=+localStorage.getItem("atkBonus")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

/* ===== æ”¾ç½®åç›Š ===== */
const now=Date.now();
const last=+localStorage.getItem("lastLogin")||now;
let diffMin=Math.floor((now-last)/60000);
const MAX_MIN=720;
if(diffMin>MAX_MIN)diffMin=MAX_MIN;

if(diffMin>0){
const gain=Math.floor(diffMin*(10+atkBonus*5));
coin+=gain;
setTimeout(()=>{
showOverlay(`ğŸ’¤ æ”¾ç½®å ±é…¬<br>${diffMin}åˆ†<br>ğŸ’° +${gain}`);
},300);
}

localStorage.setItem("lastLogin",now);

/* ===== ã‚ªãƒ¼ãƒˆã‚¿ãƒƒãƒ— ===== */
let auto=false,autoTimer=null;
function toggleAuto(){
auto=!auto;
autoBtn.textContent=`ğŸ¤– ã‚ªãƒ¼ãƒˆã‚¿ãƒƒãƒ—: ${auto?"ON":"OFF"}`;
if(auto){
autoTimer=setInterval(()=>{
if(!game.classList.contains("hidden"))tapBtn.onclick();
},100);
}else clearInterval(autoTimer);
}

/* ===== UI ===== */
const coinEl=coin;
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const player=document.getElementById("player");
const overlay=document.getElementById("overlay");
const timerEl=document.getElementById("timer");

function save(){
localStorage.setItem("coin",coin);
localStorage.setItem("dia",dia);
localStorage.setItem("atkBonus",atkBonus);
localStorage.setItem("dex",JSON.stringify(dex));
document.getElementById("coin").textContent=coin;
diaEl.textContent=dia;
atkEl.textContent=atkBonus.toFixed(1);
player.textContent=atkBonus>=10?"ğŸ‘‘ğŸ”¥":atkBonus>=5?"ğŸ˜âœ¨":"ğŸ™‚";
}
save();

function showOverlay(t){
overlay.innerHTML=t+"<br><br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
overlay.classList.remove("hidden");
}
overlay.onclick=()=>overlay.classList.add("hidden");

/* ===== ãƒ€ã‚¤ãƒ¤å¤‰æ› ===== */
function exchangeDia(){
const n=+diaNum.value;
if(!n||n<=0)return showOverlay("æ•°ã‚’å…¥åŠ›");
const cost=n*1000;
if(coin<cost)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³");
coin-=cost;dia+=n;save();
showOverlay(`ğŸ’ +${n}<br>ğŸ’° -${cost}`);
}

/* ===== ã‚¬ãƒãƒ£ ===== */
const normalTable=[
["LR",2,1.5],["UR",5,1],["HR",15,0.5],["SR",28,0.3],["R",50,0.1]
];
const diaTable=[
["LR",40,2],["UR",45,1.5],["DIVINE",15,10]
];

function roll(t){
let r=Math.random()*100,s=0;
for(const g of t){s+=g[1];if(r<s)return g;}
}

function drawGacha(){if(coin<100)return;coin-=100;const g=roll(normalTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;save();}
function draw10(){if(coin<1000)return;coin-=1000;for(let i=0;i<10;i++){const g=roll(normalTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function draw100(){if(coin<10000)return;coin-=10000;for(let i=0;i<100;i++){const g=roll(normalTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function drawDiaGacha(){if(dia<1)return;dia--;const g=roll(diaTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;save();}
function drawDia10(){if(dia<10)return;dia-=10;for(let i=0;i<10;i++){const g=roll(diaTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function drawDia100(){if(dia<100)return;dia-=100;for(let i=0;i<100;i++){const g=roll(diaTable);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}

function showDex(){
let h="ğŸ“– å›³é‘‘<br>";
for(const k in dex)h+=`${k} Ã— ${dex[k]}<br>`;
showOverlay(h);
}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp=0,maxHp=0,reward=0,rush=false,rushKills=0,rushEnd=0,countTimer=null;

function startBattle(n,h,i,r){
rush=false;
timerEl.classList.add("hidden");
bossName.textContent=n;
bossIcon.textContent=i;
bossHp=maxHp=h;
reward=r;
select.classList.add("hidden");
game.classList.remove("hidden");
updateHp();
}

tapBtn.onclick=()=>{
bossHp-=1+atkBonus;
if(bossHp<=0){
coin+=reward;save();
game.classList.add("hidden");
select.classList.remove("hidden");
}
updateHp();
};

function updateHp(){
hpText.textContent=Math.max(0,Math.ceil(bossHp));
hp.style.width=(bossHp/maxHp*100)+"%";
}

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
function startRush(){
rush=true;rushKills=0;
rushEnd=Date.now()+60000;
timerEl.classList.remove("hidden");
select.classList.add("hidden");
game.classList.remove("hidden");
spawnRushBoss();
countTimer=setInterval(updateTimer,1000);
}

function updateTimer(){
timerEl.textContent=`â± æ®‹ã‚Š ${Math.max(0,Math.ceil((rushEnd-Date.now())/1000))} ç§’`;
if(Date.now()>=rushEnd)endRush();
}

function spawnRushBoss(){
bossName.textContent=`ãƒ©ãƒƒã‚·ãƒ¥ãƒœã‚¹ ${rushKills+1}`;
bossIcon.textContent="ğŸ‘¾";
bossHp=maxHp=500+rushKills*800;
updateHp();
}

function endRush(){
rush=false;clearInterval(countTimer);
timerEl.classList.add("hidden");
coin+=rushKills*100;save();
game.classList.add("hidden");
select.classList.remove("hidden");
}
</script>
</body>
</html>
